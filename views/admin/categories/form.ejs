<%- include('../partials/header', { title: category ? 'Edit Category' : 'Add Category' }) %>

<div class="container mt-4">
    <h1 class="mb-4">
        <i class="bi bi-<%= category ? 'pencil' : 'plus-circle' %>"></i> 
        <%= category ? 'Edit Category' : 'Add New Category' %>
    </h1>

    <% if (typeof error !== 'undefined' && error) { %>
        <div class="alert alert-danger"><%= error %></div>
    <% } %>

    <form method="POST" action="<%= category ? '/admin/categories/edit/' + category._id : '/admin/categories/create' %>" 
          enctype="multipart/form-data">
        <div class="row">
            <div class="col-md-8">
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Category Name *</label>
                            <input type="text" class="form-control" name="name" 
                                   value="<%= category ? category.name : '' %>" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" name="description" rows="4"><%= category ? category.description : '' %></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" name="status">
                                <option value="active" <%= category && category.status === 'active' ? 'selected' : '' %>>Active</option>
                                <option value="inactive" <%= category && category.status === 'inactive' ? 'selected' : '' %>>Inactive</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">Category Image</div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Upload Image</label>
                            <input type="file" class="form-control" name="image" accept="image/*">
                        </div>
                        <% if (category && category.image) { %>
                            <div class="mb-3">
                                <label class="form-label">Current Image</label>
                                <div class="admin-image-preview">
                                    <img src="<%= category.image %>" 
                                         class="img-thumbnail admin-preview-img" 
                                         style="width: 100%; height: 200px; object-fit: contain; background-color: #f0f0f0; position: relative; z-index: 2;"
                                         alt="Category Image"
                                         onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect width=\'200\' height=\'200\' fill=\'%23ddd\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%23999\'%3EImage Not Found%3C/text%3E%3C/svg%3E'; this.style.backgroundColor='#f0f0f0';">
                                </div>
                                <small class="d-block text-muted mt-1" style="word-break: break-all;"><%= category.image %></small>
                            </div>
                        <% } else { %>
                            <div class="mb-3">
                                <label class="form-label">Image Preview</label>
                                <div class="admin-image-preview">
                                    <div class="admin-preview-placeholder">
                                        <p class="text-muted">No image uploaded</p>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-4">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> <%= category ? 'Update' : 'Create' %> Category
            </button>
            <a href="/admin/categories" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<%- include('../partials/footer') %>

